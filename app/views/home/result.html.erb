<div class="flex flex-col items-center justify-center p-4 m-4 rounded-xl">
  <%= link_to 'Back to Home', root_path, class: 'inline-flex items-center justify-center px-4 py-2 text-white bg-blue-500 border border-transparent rounded-md font-semibold text-xs uppercase tracking-widest hover:bg-blue-600 active:bg-blue-700 focus:outline-none focus:border-blue-700 focus:ring focus:ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150' %>
  <% if @generated_images.present? %>
  <div class="relative w-full max-w-md mt-5 overflow-hidden rounded-md shadow">
    <div class="carousel relative space-x-4" id="carousel" style="height: 512px;">
      <% @generated_images.each_with_index do |image_url, index| %>
        <div class="carousel-item <%= index == 0 ? '' : 'p-4' %>">
          <%= image_tag(image_url, alt: "Generated Image", class: "w-full h-full object-cover object-center rounded-md") %>
        </div>
      <% end %>
    </div>
    <div class="flex justify-between">
      <button class="left-0 p-2 text-white bg-gray-500 rounded-md shadow hover:bg-gray-600" onclick="moveCarousel(-1)">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="right-0 p-2 text-white bg-gray-500 rounded-md shadow hover:bg-gray-600" onclick="moveCarousel(1)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
<% end %>

  <% if @generated_text %>
    <div class="w-full max-w-md mt-5 p-5 bg-white rounded-md shadow-lg">
      <p class="text-base leading-relaxed" id="generatedText">
        <%= @generated_text %>
      </p>
    </div>
    <button class="inline-flex items-center justify-center w-full max-w-md px-4 py-2 mt-5 text-white bg-purple-500 border border-transparent rounded-md font-semibold text-xs uppercase tracking-widest hover:bg-purple-600 active:bg-purple-700 focus:outline-none focus:border-purple-700 focus:ring focus:ring-purple-300 disabled:opacity-25 transition ease-in-out duration-150" onclick="copyToClipboard()">
      Copy Text
    </button>
  <% end %>
</div>

<script>
  let carouselItems = document.getElementsByClassName("carousel-item");
  let carouselPosition = 0;

  function moveCarousel(direction) {
    carouselPosition += direction;

    if (carouselPosition < 0) {
      carouselPosition = carouselItems.length - 1;
    } else if (carouselPosition >= carouselItems.length) {
      carouselPosition = 0;
    }

    for (let i = 0; i < carouselItems.length; i++) {
      carouselItems[i].style.display = "none";
    }

    carouselItems[carouselPosition].style.display = "block";
  }

  function initializeCarousel() {
    for (let i = 0; i < carouselItems.length; i++) {
      carouselItems[i].style.display = "none";
    }

    if (carouselItems.length > 0) {
      carouselItems[0].style.display = "block";
    }
  }

  document.addEventListener("DOMContentLoaded", initializeCarousel);

  function copyToClipboard() {
    const textToCopy = document.getElementById('generatedText').innerText;
    const textarea = document.createElement('textarea');
    textarea.value = textToCopy;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    alert('Text copied to clipboard');
  }
</script>
